# v1.2.4：新增数据库检查命令、修复桌面端问题

**发布日期**：2026年2月15日

---

## 一句话总结

这次更新**新增了数据库检查命令**，方便排查问题，同时修复了桌面端的一些 Bug。

---

## 新功能：数据库检查命令

### 这次更新了什么？

新增了 `opencode db` 命令，可以直接查询和检查 OpenCode 的 SQLite 数据库。

### opencode db 是什么？

这是一个**开发者工具**，让你可以直接查看 OpenCode 的会话数据、文件记录等存储在数据库中的内容。

### 什么时候用？

当你遇到以下问题时，可以用它来排查：

| 问题 | 用法 |
|------|------|
| 会话找不到 | `opencode db "SELECT * FROM sessions"` |
| 文件记录异常 | `opencode db "SELECT * FROM files"` |
| 想看数据库结构 | `opencode db ".schema"` |

**注意**：普通用户一般不需要用这个命令，只有遇到数据问题时才用。

---

## 新功能：JSON 迁移改进

### 这次更新了什么？

在从 JSON 格式迁移到 SQLite 数据库时，所有 ID 都会从文件路径派生，确保一致性。

### 这有什么好处？

保证数据迁移后的 ID 和原来的一致，避免出现数据关联错误。

---

## 问题修复：桌面端文件树崩溃

### 之前的问题

在桌面应用中，某些情况下打开文件树会导致程序崩溃。

### 现在的情况

这个堆栈溢出问题已经修复，现在可以正常使用文件树了。

---

## 问题修复：通知清除

### 之前的问题

桌面应用的通知一直堆积，无法清除。

### 现在的情况

添加了"清除通知"操作，可以手动清空通知列表。

---

## 要不要升级？

| 情况 | 建议 |
|------|------|
| 桌面端遇到过文件树崩溃 | ✅ 升级 |
| 想排查数据库问题 | ✅ 升级 |
| 用得好好的 | 可以等下次 |

**升级命令**：

```bash
opencode upgrade
```

---

## 技术细节（可跳过）

<details>
<summary>点击展开完整更新列表</summary>

### Core（核心）

- 添加 db 命令用于数据库检查和查询
- 在 JSON 迁移期间从文件路径派生所有 ID

### Desktop（桌面应用）

- 清除通知操作
- 修复文件树组件中的堆栈溢出问题

</details>

---

[← 返回更新日志](./index.md)
