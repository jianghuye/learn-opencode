# v1.2.6：新增 D/Clojure 代码格式化、GitLab 改进

**发布日期**：2026年2月16日

---

## 一句话总结

这次更新**新增了 D 语言和 Clojure 的代码格式化器**，并改进了 GitLab 的登录体验。

---

## 新功能：D 语言格式化（dfmt）

### 这次更新了什么？

为 D 语言文件添加了 **dfmt** 格式化器支持。

### dfmt 是什么？

dfmt 是 D 语言的**官方代码格式化工具**，可以自动调整代码缩进、空格、换行等，让代码风格统一。

### 如何使用？

当你在编辑 `.d` 文件时，OpenCode 会自动使用 dfmt 格式化代码。

如果你想让代码自动格式化，可以在配置文件中启用：

```json
{
  "formatters": {
    "d": "dfmt"
  }
}
```

### D 语言是什么？

D 语言是一门系统级编程语言，兼具 C++ 的性能和 Python 的易用性。它用于：
- 高性能应用
- 游戏开发
- 系统编程

---

## 新功能：Clojure 格式化（cljfmt）

### 这次更新了什么？

为 Clojure 文件添加了 **cljfmt** 格式化器支持。

### cljfmt 是什么？

cljfmt 是 Clojure 的代码格式化工具，基于 core.style 的风格指南。

### 如何使用？

编辑 `.clj` 或 `.cljs` 文件时，OpenCode 会自动使用 cljfmt 格式化。

```json
{
  "formatters": {
    "clojure": "cljfmt"
  }
}
```

### Clojure 是什么？

Clojure 是运行在 JVM 平台上的 Lisp 方言，以**简洁**和**函数式编程**著称。它用于：
- 数据处理
- Web 开发
- 并发编程

---

## 新功能：GitLab 中途 token 刷新

### 这次更新了什么？

升级了 GitLab 提供商和认证插件，现在支持**会话中途刷新 token**，不需要重新登录。

### 这有什么好处？

之前，如果 GitLab 的 token 过期了，你需要重新登录一次。现在：
- Token 即将过期时会自动刷新
- 不会中断你的工作
- 体验更流畅

### 什么时候会刷新？

- Token 即将过期时（通常每小时）
- 不会影响正在进行的对话

---

## 新功能：Google Vertex OpenAI 兼容端点

### 这次更新了什么？

为 Google Vertex 提供商添加了 **OpenAI 兼容端点**支持。

### 这有什么好处？

如果你有支持 OpenAI API 格式的工具或服务，现在可以用它来访问 Google Vertex 的模型。

**简单说**：更灵活的模型访问方式。

---

## 新功能：Venice 参数支持

### 这次更新了什么？

为 Venice 提供商添加了更多参数支持：
- temperature
- topP
- topK
- smallOption

### 这有什么好处？

可以更精细地控制 Venice 模型的输出：
- **temperature**：控制创意程度（越高越随机）
- **topP**：核采样参数
- **topK**：限制候选词数量
- **smallOption**：小模型选项

---

## 问题修复：环境变量优先级

### 之前的问题

在 Google Vertex AI 配置中，环境变量可能会覆盖用户配置，导致设置不生效。

### 现在的情况

现在**用户定义的变量优先于环境变量**，你的配置不会被覆盖。

---

## 问题修复：多余的 LLM 调用

### 之前的问题

每条消息都会调用 LLM 生成标题，造成不必要的 API 调用和延迟。

### 现在的情况

移除了不必要的每消息标题 LLM 调用，提高了响应速度。

---

## 新功能：TUI 数据库迁移命令

### 这次更新了什么？

在 TUI 模式中添加了数据库迁移命令，可以将 JSON 存储迁移到 SQLite。

### 如何使用？

在 TUI 界面中输入 `/migrate` 命令即可触发迁移。

**注意**：迁移过程可能需要一些时间，取决于数据量。

---

## 新功能：attach 命令扩展

### 这次更新了什么？

为 `attach` 命令添加了 `--continue` 和 `--fork` 标志。

### 如何使用？

- `opencode attach --continue`：继续之前的会话
- `opencode attach --fork`：复制当前会话并创建新分支

---

## 问题修复：桌面端 Linux 显示

### 之前的问题

在 Linux 上使用桌面应用时，Wayland/X11 后端和装饰策略不一致。

### 现在的情况

统一了 Linux 的显示后端和窗口装饰策略，体验更一致。

---

## 要不要升级？

| 情况 | 建议 |
|------|------|
| 使用 D 或 Clojure | ✅ 升级 |
| 使用 GitLab | ✅ 升级 |
| 桌面端 Linux 用户 | ✅ 升级 |
| 想提升响应速度 | ✅ 升级 |
| 用得好好的 | 可以等下次 |

**升级命令**：

```bash
opencode upgrade
```

---

## 技术细节（可跳过）

<details>
<summary>点击展开完整更新列表</summary>

### Core（核心）

- 添加 dfmt 格式化器支持 D 语言文件
- 升级 GitLab 提供商和认证插件以支持中途 token 刷新
- 移除不必要的每消息标题 LLM 调用
- Google Vertex AI 配置中用户定义的变量优先于环境变量
- 为 Google Vertex 提供商添加 OpenAI 兼容端点支持
- 为 Venice 添加 temperature、topP、topK 和 smallOption 参数支持
- 添加 cljfmt 格式化器支持 Clojure 文件

### TUI（终端界面）

- 使用服务器目录路径处理提示中的文件引用
- 添加数据库迁移命令，将 JSON 存储转换为 SQLite
- 为 attach 命令添加 --continue 和 --fork 标志
- 修复 TUI 中不准确的提示

### Desktop（桌面应用）

- 统一 Linux Wayland/X11 后端和装饰策略
- 在桌面应用中使用 process-wrap 库替代手动 job 对象处理

### 社区贡献

感谢 12 位社区贡献者：
- @finalfantasia：添加 cljfmt 格式化器
- @pkx07：修正中文翻译中的专有名词
- @Brendonovich：使用 process-wrap 替代手动 job 对象
- @dpuyosa：为 Venice 添加参数支持
- @bnema：统一 Linux 显示后端
- @leehack：为 google-vertex 添加 OpenAI 兼容端点
- @hobostay：修正俄语文档翻译错误
- @rmk40：移除不必要的 LLM 标题调用
- @imanolmzd-svg：修复不准确的提示
- @vglafirov：升级 GitLab 提供商
- @OpeOginni：修复文件引用路径问题
- @burner：添加 dfmt 格式化器

</details>

---

[← 返回更新日志](./index.md)
